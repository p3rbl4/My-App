# Подробно про все виды DNS-записей

Запись A — это запись, указывающая соответствие доменного имени и IPv4-адреса. В домене второго уровня domain.ru обычно создаются запись A вида www, mail, ftp и так далее, обеспечивающие работу имён вида www.domain.ru, mail.domain.ru, ftp.domain.ru. Для IPv6-адресов создаются АААА-записи. @ используется для назначения IP-адреса самому домену (domain.ru).
* — для назначения IP-адреса всем поддоменам, не обозначенным явно в других записях.

Запись MX (mail exchanger) обеспечивает работу маршрутизации почты. Она указывает, на какой адрес почтового сервера должна направляться электронная почта. Запись MX может указывать только на имя сервера (ни в коем случае не на IP-адрес, только на hostname). Если MX не указан большинство почтовых серверов будут отправлять почту на domain.ru, т.е. A запись @.

Запись CNAME (от англ. canonical name) — это запись псевдонима для домена. Например, можно создать CNAME вида name.domain.ru псевдонимом для домена www.domain.ru. Если у вас есть сервер с айпи 192.145.20.85 и на него надо направить доменные имена www.domain.ru, mail.domain.ru, ftp.domain.ru, то проще создать одну А запись www (или какую-то другую), которая будет смотреть на IP 192.145.20.85 и добавить CNAME mail и ftp, которые будут смотреть на домен www.domain.ru. В чем удобство? При изменении IP-адреса у сервера вы поменяете одну А запись, а не три. 

Записи TXT и SRV (service record) применяются для дополнительных сервисов. С их помощью настраиваются SPF-записи, хранится текстовая информация, подтверждается владение доменом.

# Кеширующий DNS-сервер и для чего он нужен

Кеширующий DNS-сервер - это промежуточный сервер, который хранит копии DNS-записей для определенного периода времени. Он помогает ускорить процесс обработки DNS-запросов и уменьшить нагрузку на DNS-сервера.

Когда вы пытаетесь получить доступ к сайту в Интернете, ваш компьютер отправляет запрос DNS-серверу, чтобы получить IP-адрес, соответствующий доменному имени. Если у вас есть кеширующий DNS-сервер, то вместо того, чтобы отправлять запрос напрямую к DNS-серверу, ваш компьютер может сначала проверить, есть ли у кеширующего DNS-сервера копия DNS-записи для запрошенного доменного имени. Если копия существует, то компьютер получает IP-адрес из кеширующего DNS-сервера, а не отправляет запрос на удаленный DNS-сервер.

Это позволяет уменьшить время необходимое для получения IP-адреса сайта, ускоряет загрузку страниц, и снижает нагрузку на DNS-серверы.

***Сервис при помощи которого настраивается DNS сервер называется bind9*** Рассмотрим конфигурационные файлы лежащие в /etc/bind

>**bind.keys** - этот файл предназначен для ключей, используемых в **dnssec**.

>**db.{0,127,255,empty,local}** - эти файлы можно назвать служебной информацией. Они определяют доменную зону локалхоста и дефолтные реверсные зоны.

>**db.root** - тут содержатся адреса корневых **DNS**-серверов.

>**named.conf** - основной конфигурационный файл. При запуске сервис ищет именно его, если не указано иное. Для удобства файл разбит на несколько частей, которые добавляются в него с помощью инструкции **include**.

>**named.conf.default-zones** - в этом файле подключаются дефолтные доменные зоны, описанные ранее.

>**named.conf.local** - тут можно описать доменные зоны, которые мы заведем на нашем сервере.

>**named.conf.options** - тут описываются настройки самого сервера, а не доменных зон.

>**rndc.key** - ключ для утилиты **rndc**, с помощью которой управляют **DNS**-сервером. Утилита может жить как на том же сервере, так и на любом другом компьютере. Главное описать параметры подключения к **DNS**-серверу.

>**zones.rfc1918** - тут описываются обратные зоны для серых подсетей. По умолчанию для них для всех используется **empty.db**, но при необходимости всегда можно переопределить.

# Как поднять собственный DNS-сервер (лайт)

Для начала установим необходимые утилиты
```bash
apt install bind9 dnsutils
```
Открываем конфигурационный файл сервера
```bash
vim named.conf.options
```
Привести конфиг необходимо к следующему состоянию, необходимо поменять IP адреса локальной сети
```bash
acl "trusted" {

127.0.0.0/8;

192.168.1.0/24;

};

  

acl "all" {

0.0.0.0/0;

};

  

options {

directory "/var/cache/bind";

listen-on {127.0.0.1;};
allow-query {

trusted;

};

allow-query-cache {

trusted;
};

allow-recursion {

trusted;

};

forward first;

forwarders {

8.8.8.8;

8.8.4.4;

};

};
```
Перезапускаем сервис 
```bash
systemctl restart bind9
```
Проверка
```bash
host www.yandex.ru 127.0.0.1
```

Под каждый домен заводится отдельный файл. В этом файле содержится следующая информация:

1. Описываются днс-сервера, отвечающие за функционирование домена
2. Описываются таймауты для обновления данных о домене для кэширующих серверов.
3. Электронная почта администратора домена
4. Ну и то, ради чего мы это затеваем - поддомены.
5. 
Собственные домены принято складывать в папку **/etc/bind/master**
Тестовый домен будет именовать себя как **homelan.local**
```bash
sudo mkdir /etc/bind/master
sudo touch /etc/bind/master/homelan.zone
```
Открываем файл где будет лежать конфигурация домена и приводим его к следующуему виду
```bash
$ttl 38400

  

homelan.local. IN SOA admin.homelan.local. root.homelan.local. (

2008041601 ; Serial

10800 ; Refresh

3600 ; Retry

604800 ; Expire

38400 ; Negative cache ttl

)

@ IN NS ns.homelan.local.

@ IN A 192.168.1.1

ns IN A 192.168.1.1

srv1 IN A 192.168.1.2
```
**$TTL 38400** - означает, что кэширующему днс-серверу нужно хранить ответы от нашего днс-сервера минимум 38400 секунд.

**SOA**-запись. Она является необходимой для работы. Обычно записывается в самом начале файла.
Для чего она нужна? Она хранит общие настройки для зоны.
-   **Serial** — порядковый номер изменения. Его необходимо каждый раз менять вручную при редактировании файла. С помощью него вторичный сервер (если такой есть), может определить, что были изменения и начать процесс копирования настроек.  
-   **Refresh** указывает вторичным серверам, через какой промежуток времени они должны сделать запрос на обновление зоны.  
-   **Retry** говорит вторичным серверам, как часто повторять попытки на обновление зоны, если первичный сервер не смог дать ответ (сервис был недоступен).  
-   **Expire** — время в секундах, которое может работать вторичный сервер, если недоступен первичный. Если данный период истечет, а вторичный сервер так и не смог обновить зону, он должен прекратить отвечать на запросы.  
А также попутно email администраторов домена (правда вместо собаки пишем точку).
admin.homelan.local и root.homelan.local это как раз email-ы.

**IP-адрес указываем из своей подсети**

*Так вот. Файл с описанием доменной зоны у нас есть. Теперь его надо добавить в настройки.*

Для этого нужно открыть файл /**etc/bind/named.conf.local** и добавить туда следующее
```bash
zone "homelan.local" {

     type master;
     file "/etc/bind/master/homelan.zone";
     allow-query { all; };

};
```
После чего выполняем проверку и перезапуск, если всё ок
```bash
sudo named-checkconf
systemctl restart bind9
```

Проверяем, что всё работает
```bash
host homelan.local 127.0.0.1
```

Источник: https://yodo.im/dns_server
[[Сети]]